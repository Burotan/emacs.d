#include <stdio.h>
#include <curl/curl.h>

int main(int argc, char** argv) {
  if(argc < 2){
    printf("Usage is: cookie [domain]\n");
    return 1;
  }
  
  char *domain = argv[1];
 
  CURL *curl;
  CURLcode res;
  struct curl_slist *cookies = NULL;

  // libcurl'ü başlat
  curl = curl_easy_init();

  if(curl) {
    // Hedef URL
    curl_easy_setopt(curl, CURLOPT_URL, domain);

    // Çerez motorunu etkinleştir (boş string hafızada tutulmasını sağlar)
    curl_easy_setopt(curl, CURLOPT_COOKIEFILE, "");

    // İsteği gerçekleştir
    res = curl_easy_perform(curl);

    if(res != CURLE_OK) {
      fprintf(stderr, "Hata: %s\n", curl_easy_strerror(res));
    } else {
      // Bilinen tüm çerezleri al
      res = curl_easy_getinfo(curl, CURLINFO_COOKIELIST, &cookies);

      if(!res && cookies) {
        struct curl_slist *nc = cookies;
        int i = 1;
        printf("Alınan Çerezler:\n");
        while(nc) {
          printf("[%d]: %s\n", i++, nc->data);
          nc = nc->next;
        }
        // Belleği temizle
        curl_slist_free_all(cookies);
      } else {
        printf("Hiç çerez bulunamadı.\n");
      }
    }

    // Kaynakları serbest bırak
    curl_easy_cleanup(curl);
  }

  return 0;
}
